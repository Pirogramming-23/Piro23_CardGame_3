{% extends 'base.html' %} {% block content %}

<h1>ğŸ® ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!</h1>
<p>ì¹´ë“œë¥¼ ì„ íƒí•´ ìƒëŒ€ë°©ì—ê²Œ ë„ì „í•˜ì„¸ìš”.</p>

<form id="gameForm" method="post" action="{% url 'create_game' %}">
  {% csrf_token %}
  <div class="card-box">
    {% for card_number in available_cards %}
    <div class="card" data-card-value="{{ card_number }}">
      {{ card_number }}
    </div>
    {% endfor %}
  </div>

  <input type="hidden" name="selected_card" id="selected_card_input" />

  <div style="margin-top: 30px">
    <label for="defender_select">ìƒëŒ€ë°© ì„ íƒ:</label>
    <select name="defender" id="defender_select" class="user-select-box">
      <option value="" disabled selected>ìƒëŒ€ë°©ì„ ì„ íƒí•˜ì„¸ìš”</option>
      {% if other_users_with_status %} {% for data in other_users_with_status %}
      <option
        value="{{ data.user.id }}"
        {%
        if
        data.has_pending_game
        %}disabled{%
        endif
        %}
      >
        {{ data.user.username }} {% if data.has_pending_game %} (ë°©ì–´ë¥¼ ê¸°ë‹¤ë¦¬ê³ 
        ìˆìŠµë‹ˆë‹¤){% endif %}
      </option>
      {% endfor %} {% else %}
      <option value="" disabled>ë„ì „í•  ìƒëŒ€ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</option>
      {% endif %}
    </select>
  </div>

  <button type="submit" id="startGameButton" disabled>
    ìƒëŒ€ë°©ì—ê²Œ ë„ì „í•˜ê¸°
  </button>
</form>

<p style="margin-top: 30px">
  <a href="{% url 'index' %}">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
</p>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cards = document.querySelectorAll(".card");
    const selectedCardInput = document.getElementById("selected_card_input");
    const startGameButton = document.getElementById("startGameButton");
    const defenderSelect = document.getElementById("defender_select");

    let selectedValue = null;
    // ì´ˆê¸° selectedDefender ê°’ì€ ë“œë¡­ë‹¤ìš´ì˜ ì²« ë²ˆì§¸ ìœ íš¨í•œ(disabledê°€ ì•„ë‹Œ) ì˜µì…˜ ë˜ëŠ” null
    let selectedDefender = defenderSelect.value;
    if (
      defenderSelect.options.length > 0 &&
      defenderSelect.options[defenderSelect.selectedIndex].disabled
    ) {
      selectedDefender = null; // ì´ˆê¸° ì„ íƒëœ ì˜µì…˜ì´ disabledë¼ë©´ nullë¡œ ì´ˆê¸°í™”
    }

    // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    cards.forEach((card) => {
      card.addEventListener("click", function () {
        cards.forEach((c) => c.classList.remove("selected"));
        this.classList.add("selected");
        selectedValue = this.dataset.cardValue;
        selectedCardInput.value = selectedValue;
        checkFormValidity();
      });
    });

    // ìˆ˜ë¹„ì ì„ íƒ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    defenderSelect.addEventListener("change", function () {
      selectedDefender = this.value;
      checkFormValidity();
    });

    // í¼ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
    function checkFormValidity() {
      // ì¹´ë“œê°€ ì„ íƒë˜ì—ˆê³ , ìœ íš¨í•œ ìˆ˜ë¹„ìê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸ (ë¹„í™œì„±í™”ë˜ì§€ ì•Šì€ ì˜µì…˜ì¸ì§€ë„ í¬í•¨)
      const selectedOption =
        defenderSelect.options[defenderSelect.selectedIndex];
      if (
        selectedValue !== null &&
        selectedDefender &&
        selectedDefender !== "" &&
        !selectedOption.disabled // ì„ íƒëœ ì˜µì…˜ì´ disabledê°€ ì•„ë‹Œì§€ ì¶”ê°€ í™•ì¸
      ) {
        startGameButton.disabled = false;
      } else {
        startGameButton.disabled = true;
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìœ íš¨ì„± ê²€ì‚¬ ì‹¤í–‰
    checkFormValidity();
  });
</script>

{% endblock %}
